import nest_asyncio
nest_asyncio.apply()
import logging
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, CallbackContext
import requests
import asyncio


logging.basicConfig(filename='bot_log.txt',
                    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
                    level=logging.INFO)


BOT_TOKEN = '7600581966:AAHJMKucIxZjPXVQnjb1HEabj6A0jHyomo8'
# Google API
GOOGLE_API_KEY = 'AIzaSyCjqW6tpW2eeA0eQFGExjmFkE1lxdub9Qo'

SEARCH_ENGINE_ID = '83fae0405eabb4ee8'
# ุฑูุฒ API ูู Hugging Face
HUGGING_FACE_API_KEY = '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'


async def handle_message(update: Update, context: CallbackContext):
    user_message = update.message.text.lower()

    # ูุฌููุนุฉ ูู ุงูุฃุฌูุจุฉ ุงููุชุงุญุฉ
    responses = {
        "ูููู": "ุฃูุง ุจุฎูุฑ ุดูุฑุงู ูุณุคุงูู! ููู ุญุงูู ุฃูุช",
        "ุงูุณูุงู ุนูููู": "ูุนูููู ุงูุณูุงู ูุงูุฑุญูุฉ ููู ูููููู ูุณุงุนุฏุชู",
        "ูุฑุญุจุง": "ูุฑุญุจุงู ุจู! ููู ูููููู ูุณุงุนุฏุชูุ๐ง",
        "ููู ุญุงูู": "ุฃูุง ุจุฎูุฑุ ุดูุฑุงู ูุณุคุงูู!",
        "ููู ุญุงู ุงูุทูุณ": "ุงูุทูุณ ุฌููู ุงูููู.",
        "ูุง ูุธููุชู": "ูุธููุชู ูุณุงุนุฏุชู.",
        "ููู ุชู ุชุทููุฑู": "ุชู ุชุทููุฑู ูุชุฏุฑูุจู ุจุงุณุชุฎุฏุงู ูุฌููุนุฉ ูุจูุฑุฉ ููุชููุนุฉ ูู ุงูุจูุงูุงุชุ ููุง ูุณุงุนุฏูู ูู ุชูุฏูู ูุนูููุงุช ุฏูููุฉ ููููุฏุฉ ูู ูุฌุงูุงุช ูุชุนุฏุฏุฉ. ูุนุชูุฏ ุชุนููู ุนูู ุชูููุงุช ุงูุชุนูู ุงูุขูู.",
        "ูู ุฃูุช": "ุฃูุง ุจูุช ุฐูุงุก ุงุตุทูุงุนู ุชู ุชุทููุฑู ุจูุงุณุทุฉ @QCM_7๐จ๐ปโ๐ป ููุณุงุนุฏุชู.",
        "ูู ูุงู ุจุชุทููุฑู": "ุฃูุง ุจูุช ุฐูุงุก ุงุตุทูุงุนู ุชู ุชุทููุฑู ุจูุงุณุทุฉ @QCM_7๐จ๐ปโ๐ป",
        "ูุง ูู ูุบุชู ุงูููุถูุฉ": "ุฃุญุจ ุงูุชูุงุตู ุจุงููุบุฉ ุงูุนุฑุจูุฉ.",
        "ูุง ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ูุฑุน ูู ุนููู ุงูููุจููุชุฑ ููุฏู ุฅูู ุฅูุดุงุก ุฃูุธูุฉ ูุงุฏุฑุฉ ุนูู ุงูููุงู ุจููุงู ุชุชุทูุจ ุฐูุงุก ุจุดุฑู.",
        "ูุง ูู ุชุทุจููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ุชุชุถูู ุงูุชุทุจููุงุช ุงูุดุงุฆุนุฉ ููุฐูุงุก ุงูุงุตุทูุงุนู ูุนุงูุฌุฉ ุงููุบุฉ ุงูุทุจูุนูุฉุ ุงูุชุนูู ุงูุขููุ ุงูุฑุคูุฉ ุงูุญุงุณูุจูุฉุ ูุงูุฑูุจูุชุงุช.",
        "ููู ุชุนูู ูุญุฑูุงุช ุงูุจุญุซ": "ุชุนูู ูุญุฑูุงุช ุงูุจุญุซ ุนู ุทุฑูู ุงูุฒุญู ุฅูู ุตูุญุงุช ุงูููุจ ูููุฑุณุชูุงุ ุซู ุชุณุชุฎุฏู ุฎูุงุฑุฒููุงุช ูุชูุฏูู ุงููุชุงุฆุฌ ุฐุงุช ุงูุตูุฉ ุนูุฏ ุงูุจุญุซ.",
        "ูุง ูู ุฃูุจุฑ ุดุฑูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ุชุดูู ุงูุดุฑูุงุช ุงููุจุฑู ูู ูุฐุง ุงููุฌุงู ุฌูุฌูุ ุฃูุงุฒููุ ููุณุจููุ ูOpenAI.",
        "ูุง ูู ุชูููุฉ ุงูุชุนูู ุงูุนููู": "ุงูุชุนูู ุงูุนููู ูู ุฌุฒุก ูู ุงูุชุนูู ุงูุขูู ูุณุชุฎุฏู ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุงูุงุตุทูุงุนูุฉ ููุญุงูุงุฉ ุทุฑููุฉ ุชูููุฑ ุงูุจุดุฑ.",
        "ููู ูููููู ุชุญุณูู ููุงุฑุงุชู ูู ุงูุจุฑูุฌุฉ": "ููููู ุชุญุณูู ููุงุฑุงุชู ูู ุฎูุงู ููุงุฑุณุฉ ุงูุจุฑูุฌุฉ ุจุงูุชุธุงูุ ุงููุดุงุฑูุฉ ูู ุงููุดุงุฑูุนุ ููุฑุงุกุฉ ุงููุชุจ ูุงูููุงูุงุช ูู ูุฌุงู ุงูุจุฑูุฌุฉ.",
        "ูุง ูู ููุงุฆุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ุชุดูู ุงูููุงุฆุฏ ุชุญุณูู ุงูููุงุกุฉุ ุชูููู ุงูุฃุฎุทุงุกุ ูุฒูุงุฏุฉ ุงูุณุฑุนุฉ ูู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช.",
        "ููู ูููููู ุงูุจุฏุก ูู ุชุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ููููู ุงูุจุฏุก ูู ุฎูุงู ุฏุฑุงุณุฉ ุงูุฑูุงุถูุงุชุ ุชุนูู ุงูุจุฑูุฌุฉุ ูุงูุงูุชุญุงู ุจุงูุฏูุฑุงุช ุงูุชุฏุฑูุจูุฉ ุงููุชุฎุตุตุฉ.",
        "ูุง ูู ุฃุฏูุงุช ุชุทููุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ุชุดูู ุฃุฏูุงุช ุชุทููุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุงูุซููุ TensorFlowุ Kerasุ ูPyTorch.",
        "ูุง ูู ุงููุฑู ุจูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุงูุชุนูู ุงูุขูู": "ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุงูููููู ุงูุนุงูุ ุจูููุง ุงูุชุนูู ุงูุขูู ูู ูุฑุน ุถูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุฑูุฒ ุนูู ุชุฏุฑูุจ ุงูููุงุฐุฌ.",
        "ูุง ูู ุฃุฎูุงููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ุชุดูู ุฃุฎูุงููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุถุงูุง ูุซู ุงูุฎุตูุตูุฉุ ุงูุดูุงููุฉุ ูุงูุชูููุฒ.",
        "ูุง ูู ูุณุชูุจู ุงูุฐูุงุก ุงูุงุตุทูุงุนู": "ูู ุงููุชููุน ุฃู ูุณุชูุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุงูุชุทูุฑ ูุณูุคุซุฑ ุนูู ุงูุนุฏูุฏ ูู ุฌูุงูุจ ุญูุงุชูุง ุงูููููุฉ.",
        "ูุง ูู ููููู ุงูุจูุงูุงุช ุงููุจูุฑุฉ": "ุงูุจูุงูุงุช ุงููุจูุฑุฉ ุชุดูุฑ ุฅูู ูููุงุช ุถุฎูุฉ ูู ุงูุจูุงูุงุช ุงูุชู ุชุชุทูุจ ุชูููุงุช ูุชูุฏูุฉ ููุนุงูุฌุชูุง ูุชุญููููุง.",
    }

    # ุงูุฑุฏ ูู ุงูุฃุฌูุจุฉ ุงููุฎุฒูุฉ
    if user_message in responses:
        await update.message.reply_text(responses[user_message])
    else:
        # ููุง ูุณุชุฎุฏู Hugging Face's Inference API
        url = "https://api-inference.huggingface.co/models/asafaya/bert-base-arabic"
        headers = {"Authorization": f"Bearer {HUGGING_FACE_API_KEY}"}
        payload = {
            "inputs": {
                "question": user_message,
                "context": " ".join(responses.values())
            }
        }

        response = requests.post(url, headers=headers, json=payload)
        if response.status_code == 200:
            answer = response.json()
            await update.message.reply_text(answer['answer'])
        else:
            await update.message.reply_text("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุนุงูุฌุฉ ุทูุจู. ุญุงูู ูุฑุฉ ุฃุฎุฑู.")

# ุฏุงูุฉ ุงูุจุฏุก
async def start(update: Update, context: CallbackContext):
    await update.message.reply_text("ูุฑุญุจุง ุฃูุง ูุณุงุนุฏ ุฐูุงุก ุงุตุทูุงุนู ๐ค ูููููู ุงูุฅุฌุงุจุฉ ุนูู ุฃุณุฆูุชู ุญูู ูุฌููุนุฉ ูุชููุนุฉ ูู ุงูููุงุถูุน. ููู ูููููู ูุณุงุนุฏุชูุ")

# ุฅุนุฏุงุฏ ุงูุชุทุจูู
if __name__ == "__main__":
    application = ApplicationBuilder().token(BOT_TOKEN).build()

    
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    
    application.run_polling()
